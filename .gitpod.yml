image:
  file: .gitpod.Dockerfile
tasks:
  # Before running init, direnv will be reloaded and build the local flake to the nix store
  - init: >
      # If there is a prebuilt .nix-store serialisation we load it
      if [ -f .nix-store ]; then nix-store --import < .nix-store; fi &&
      # We create a .nix-store serialisation so that it's prebuilt
      nix-store --export $(nix-store -qR gitpod-flake-ghc9) > .nix-store &&
      cabal build

    command: >
      cabal test

vscode:
  extensions:
    - bbenoist.Nix
    - rust-lang.rust
    - haskell.haskell
    - mkhl.direnv
